Fix errors and warnings in tests, doctests, build docs

1. Run `cargo test --all-targets`
2. Run `cargo test --doc`
3. Run `cargo doc --no-deps`
